<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Category: Lm2842 | scon.pro]]></title>
  <link href="http://mupimenov.github.io/blog/categories/lm2842/atom.xml" rel="self"/>
  <link href="http://mupimenov.github.io/"/>
  <updated>2017-02-04T07:21:33+03:00</updated>
  <id>http://mupimenov.github.io/</id>
  <author>
    <name><![CDATA[Пименов Михаил]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Блок управления внешней нагрузкой контроллера для гидропоники]]></title>
    <link href="http://mupimenov.github.io/blog/2015/08/09/load-control-block-of-controller-for-hydroponics/"/>
    <updated>2015-08-09T09:57:15+03:00</updated>
    <id>http://mupimenov.github.io/blog/2015/08/09/load-control-block-of-controller-for-hydroponics</id>
    <content type="html"><![CDATA[<p>Блок является частью <a href="/blog/2015/07/25/controller-for-hydroponics">контроллера</a> для гидропоники и выполняет управление четырьмя массивами светодиодов.</p>

<p><img src="/images/2015-08-09-load-control-block-of-controller-for-hydroponics/LedPower.png"></p>

<h3>Step-down преобразователь +30В -> +15В</h3>

<p>Преобразователь выполнен на базе <strong>LM2842</strong> (U1). Параметры преобразователя и порядок его настройки приводится в описании <a href="blog/2015/08/02/main-block-of-controller-for-hydroponics/">основного блока</a>.</p>

<p><strong>Расчёт:</strong></p>

<p>1) Входные данные: VIN = 30 В, VOUT = 15 В, IOUT = 0,5 А, Iripple = 0,15 А.</p>

<p>2) R1 = 1,5 кОм, R2 = (VOUT/0,765 – 1) * R1 = (15 / 0,765 – 1) * 1,5 = 28 кОм.</p>

<p>3) СIN = 10 мкФ (керамика).</p>

<p>4) L1 = (30 – 15) * 15 / (30 * 0,15 * 550 * 10<sup>3</sup>) = 91 мкГн (SDR1006-101KL).</p>

<p>5) COUT = 22 мкФ, Vripple=0,15 * (0,35 + [1 / (8 * 550 * 10<sup>3</sup> * 22 * 10<sup>-6</sup>)] = 0,053 В.</p>

<p>6) CBOOT = 1,0 мкФ.</p>

<p>7) D1 – 10BQ060 (60 В, 1,0 А).</p>

<h3>Преобразователь +15В -> +3,3В</h3>

<p>Преобразователь построен на базе микросхемы <strong>LM1117</strong>-N-3 (U2), характеризуемой максимальным током 800 мА.</p>

<p><strong>Расчёт:</strong></p>

<p>1) Входной конденсатор – 10 мкФ (тантал).</p>

<p>2) Выходной конденсатор – от 10 мкФ, рекомендуется 22 мкФ (тантал, ESR от 0,3 до 22 Ом).</p>

<h3>Измерение тока в цепи нагрузки</h3>

<p>Последовательно с нагрузкой соединён резистор номиналом 1 Ом (R29 - R32). Падение напряжения на этом резисторе пропорционально току, протекающему в цепи нагрузки. Это падение напряжения измеряется микроконтроллером <strong>STM32F031F</strong> (U3). Измеренное падение напряжения преобразуется микроконтроллером в периодический импульсный сигнал, имеющий фиксированную частоту 50 Гц и изменяемый коэффициент заполнения импульсов, пропорциональный падению напряжения. Этот периодический сигнал (F1-F4) поступает через транзистор (Q3-Q6) на оптопару HCPL053X (U10, U11) и далее в основной блок контроллера.</p>

<p>Прямой ток через диод оптопары HCPL053X составляет IF = (3,3 – VF)/R = (3,3 – 1,45) / 100 = 18,5 мА</p>

<p>Максимальный выходной ток оптопары при IF = 18,5 мА составляет примерно IO = 6 мА.</p>

<p>Для управления оптопарой выбран транзистор BC807 (коэффициент усиления по току – 100, не менее; в базе резистор 4,7 кОм, то есть базовый ток составляет (3,3 – 0,7)/4,7 = 0,55 мА, что позволяет получить ток коллектора от 50 мА и выше).</p>

<h3>Управление нагрузкой</h3>

<p>Управляющие сигналы на открытие силовых ключей поступают из основного блока контроллера на оптопары <strong>HCPL053X</strong> (U4, U7). Напряжение питания оптопар составляет +15 В.</p>

<p>Сигнал с коллектора оптопары поступает на инверсный вход драйвера n-канального MOSFET-транзистора (U5, U6 и U8, U9). В качестве драйвера используется микросхема IR2128S (с возможностью контроля КЗ; данная функция не используется). Драйвер также как и оптопара запитан от источника +15 В.</p>

<p>Сигнал с драйвера через резистор номиналом 100 Ом поступает на затвор силового n-канального транзистора IRF7341 (Q1, Q2). Силовой транзистор коммутирует напряжение +30 В на LC-фильтр нагрузки.</p>

<h3>Расчёт LC-фильтра нагрузки</h3>

<p>Расчёт происходит двумя способами, которые дают схожие результаты:</p>

<ul>
<li>способом, использованном для расчёта преобразователя +30В -> +15В;</li>
<li>способом, описанном в статье &ldquo;<em>Катушки индуктивности Bourns для преобразователей энергии</em>&rdquo;.</li>
</ul>


<p>Начальные данные: fsw = 10 кГц, VIN = 30 В, IOUT = 1 А. Выходное напряжение изменяется в диапазоне от 0 до 30 В.</p>

<p>Из статьи &ldquo;<em>Катушки индуктивности Bourns для преобразователей энергии</em>&rdquo;:</p>

<p>1) Период импульсов: Tsw = 1 / fsw = 100 мкс.</p>

<p>2) <strong>Средний</strong> коэффициент заполнения: D = (VOUTmax – VOUTmin) / 2VIN = (30 – 0) / (2 * 30) = 0,5.</p>

<p>3) Время открытия ключа Ton = DTsw = 50 мкс.</p>

<p>4) Величина пульсаций тока: Iripple = 0,3 * IOUT = 0,3 А.</p>

<p><em>Примечания</em></p>

<p>1 Величина пульсаций (и это важно) означает разницу между значением тока, протекающим через катушку в момент закрытия ключа, и значением тока, протекающим через катушку в момент открытия ключа. Другими словами, в момент открытия ключа ток, имеющий значение I1, начинает линейно расти до значения I1 + Iripple. В момент закрытия ключа ток начинает линейно уменьшаться (происходит заряд конденсатора COUT) до значения I1. С новым импульсом на открытие ключа цикл повторяется.</p>

<p>2 Из величины Iripple следует, что значение минимального стационарного тока составляет Is = Iripple/2 = 150 мА. Минимальный стационарный ток – это ток, который может быть передан дросселем в ёмкость COUT после закрытия ключа при заданном коэффициенте заполнения импульсов коммутации ключа. Если нагрузка требует меньший ток, то появятся автоколебания тока после закрытия ключа (ток потечёт в обратную сторону – в дроссель). Чтобы это исключить после дросселя устанавливается диод Шоттки.</p>

<p>5) Падение напряжения на катушке: V = VIN – (VOUTmax - VOUTmin) / 2 – Vdiode = 30 – 15 – 1 = 14 В.</p>

<p>6) Минимальное значение индуктивности: L2 = L3= L4 = L5 = VTon / Iripple = 2,333 мГн</p>

<p>7) COUT = C12 = C15 = C19 = C22 = 150 мкФ, ESR = 0,3 (танталовый). Пульсации напряжения для выбранного конденсатора составят: Vripple = Iripple(ESR + [1 / (8 * fsw * COUT)]) = 0,115 В.</p>

<p>Расчёт дросселя выполнялся в программе DrosselRing (1100):</p>

<p><img src="/images/2015-08-09-load-control-block-of-controller-for-hydroponics/LedL.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Основной блок контроллера для гидропоники]]></title>
    <link href="http://mupimenov.github.io/blog/2015/08/02/main-block-of-controller-for-hydroponics/"/>
    <updated>2015-08-02T09:42:35+03:00</updated>
    <id>http://mupimenov.github.io/blog/2015/08/02/main-block-of-controller-for-hydroponics</id>
    <content type="html"><![CDATA[<p>Основной блок является &ldquo;мозгами&rdquo; <a href="/blog/2015/07/25/controller-for-hydroponics">контроллера</a> для гидропоники.
Схема основного блока приводится на двух листах.</p>

<h2>Лист 1</h2>

<p><img src="/images/2015-08-02-main-block-of-controller-for-hydroponics/Main1.png"></p>

<h3>Step-down преобразователь +12В -> +3,3В</h3>

<p>Преобразователь построен на базе <strong>LM2842</strong> (U7). Его характеристики:</p>

<ul>
<li>частота переключений fsw = 550 кГц;</li>
<li>опорное напряжение VFB = 0,765 В;</li>
<li>входное напряжение VIN = 12 В.</li>
</ul>


<p><strong>Настройка (из тех. описания на LM2842):</strong></p>

<p>1) Величина выходного напряжения:
VOUT = VFB * (1 + R39/R38),
где R38 = 100..10000 Ом</p>

<p>2) Входной конденсатор С4 (керамика с низким ESR; X5R или X7R). Рекомендуемые значения ёмкости от 2,2 до 10 мкФ</p>

<p>3) Дроссель L1 = [(VIN - VOUT) * VOUT] / (VIN * Iripple * fsw)</p>

<p>С ростом допустимых пульсаций тока Iripple величина индуктивности уменьшается, но возрастают потери на намагничивание, потери в сердечнике. Это также требует выходного конденсатора большей ёмкости. Рекомендуемое значение Iripple составляет около 30% от величины выходного тока.
Расчёт индуктивности ведётся для максимального значения VIN.
КПД преобразователя напрямую зависит от сопротивления дросселя (лучшие показатели достигаются с использованием толстого провода). Рекомендуется использовать такой индуктор, в котором потери на нагрев составляют 2% от выходной мощности (другими словами, активное сопротивление дросселя составляет 2% от сопротивления нагрузки). Начальным вариантом является дроссель с индуктивностью от 10 до 22 мкГн и максимальным током 1,1 А или выше.</p>

<p>4) Выбор выходного конденсатора C6 зависит от величины максимальных допустимых пульсаций выходного напряжения. При постоянной частоте fsw величина пульсаций напряжения</p>

<p>Vripple = Iripple * (ESR + [1 / (8 * fsw * COUT)]).</p>

<p>Необходимо выбирать керамические конденсаторы с низким ESR. Рекомендуемый номинал от 22 до 100 мкФ с ESR ≤ 0,1 Ом.</p>

<p>5)   C5 ≥ 0,15 мкФ (керамика). Рекомендуется 1,0 мкФ.</p>

<p><strong>Расчёт:</strong></p>

<p>1) Входные данные: VIN = 12 В, VOUT = 3,3 В, IOUT = 0,5 А, Iripple = 0,15 А.</p>

<p>2) R38 = 1,4 кОм, R39 = (VOUT / 0,765 – 1) * R38 = (3,3 / 0,765 – 1) * 1,4 = 4,7 кОм.</p>

<p>3) С4 = 10 мкФ (керамика).</p>

<p>4) L1 = (12 – 3,3) * 3,3 / (12 * 0,15 * 550 * 10<sup>3</sup>) = 29 мкГн (SDR1006-330KL: 33 мкГн, Irms= 1,5 А).</p>

<p>5) C6 = 22 мкФ, Vripple = 0,15 * (0,35 + [1/(8 * 550 * 10<sup>3</sup> * 22 * 10<sup>-6</sup>)] = 0,053 В.</p>

<p>6) C5 = 1,0 мкФ.</p>

<p>7) D1 – 10BQ060 (60 В, 1,0 А).</p>

<h3>Аналоговая часть</h3>

<p>С целью уменьшения влияния цифровой части устройства на измеряемые аналоговые сигналы вводится «развязка» питания через LC-фильтр (по примеру схемы платы LPC1830-Xplorer).</p>

<p>Измерение аналоговых сигналов происходит с помощью резистивных делителей и операционных усилителей <strong>AD8606</strong> (питание +3,3 В) с коэффициентом усиления 1 (на схеме U3, U5).</p>

<p>Резистивный делитель построен на резисторах номиналами 10 и 3,3 кОм (R19 и R21, R26 и R27, R32 и R33) и позволяет измерять входное напряжение величиной до 13,3 В.</p>

<p>После делителя сигнал смещается вверх на 0,5 В (с помощью U3:A) и поступает на неинверсный вход операционного усилителя. С выхода операционного усилителя повторённый сигнал идёт на вход АЦП микроконтроллера.</p>

<h3>Дискретные сигналы</h3>

<p><strong>Входные сигналы типа &ldquo;сухой контакт&rdquo;</strong></p>

<p>Измерение входного дискретного сигнала типа «сухой контакт» (-, минус) осуществляется с помощью подтянутого к питанию +12 В резистора (номинал 10 кОм) и транзисторной сборки <strong>ULN2804</strong>, выбранной исходя из величины опорного напряжения (+12 В).</p>

<p>Коллектор выходного транзистора ULN2804 (U6) подтянут к питанию +3,3 В. Сигнал с коллектора поступает на сдвиговый регистр <strong>74HC165</strong> (U4), который по сигналу микроконтроллера преобразует входной параллельный код в выходной последовательный код и выдаёт микроконтроллеру состояние датчиков типа «сухой контакт».</p>

<p><strong>Выходные сигналы</strong></p>

<p>К выходным дискретным сигналам относятся: силовые напряжением ~220 В (ток до 5 А) и силовые напряжением +12 В (ток до 0,1 А).</p>

<p>Выдача дискретных сигналов происходит с помощью:</p>

<ul>
<li>сдвигового регистра <strong>74HC595</strong> (U1), в который микроконтроллер загружает слово (каждый бит слова определяет состояние выхода);</li>
<li>транзисторной сборки <strong>ULN2803</strong> (U2), которая выдаёт сигналы на реле (для коммутации напряжения ~220 В) и p-канальные транзисторы (для коммутации напряжения +12 В).</li>
</ul>


<p>Коммутацию напряжения ~220 В выполняет реле типа TRJ-12DC (RL1-RL4). В цепи фазы установлен предохранитель с номинальным током 5 А (FU1-FU4).</p>

<p>Коммутацию напряжения +12 В выполняет транзистор <strong>IRF7314</strong> (Q1). В цепи +12 В установлен самовосстанавливающийся защитный резистор с номинальным током 0,1 А (R4, R8).</p>

<h2>Лист 2</h2>

<p><img src="/images/2015-08-02-main-block-of-controller-for-hydroponics/Main2.png"></p>

<p>В центре схемы - микроконтроллер <strong>STM32F407Z</strong>. Он тактируется кварцевым резонатором частотой 12 МГц (X1 - HC-49SM, печатный монтаж), зашунтированным конденсаторами по 18 пФ (керамика).</p>

<p>Для питания микроконтроллера введён массив керамических конденсаторов номиналами 1,0 и 0,1 мкФ (C15-C22).</p>

<p>Отладка микроконтроллера происходит по интерфейсу JTAG. Для этого на плате размещается разъём XP1 (IDC-20MS).</p>

<h3>Диагностический интерфейс</h3>

<p>Для отладки устройства без использования специализированных средств (JTAG-программатора) служит выделенный USB-интерфейс, который построен на микросхеме <strong>CP2102</strong> (U10), представляющей собой полноценный преобразователь USB-UART.</p>

<p>Кроме стандартной обвязки CP2102 (рекомендации по её параметрам приводятся в описании к микросхеме) добавлен транзистор, который формирует сигнал RESET (сброс микроконтроллера). Дополнительный сигнал ISP нужен для ввода микроконтроллера в режим загрузчика.</p>

<p>Сигнал RESET определяется состоянием на линии DTR, сигнал ISP – состоянием на линии RTS. Сигнал сброса микроконтроллера RESET проходит через ФНЧ с постоянной времени τ = R77 * C13 = 47000 * 0,1 * 10-6 = 4,7 мс.</p>

<h3>Ethernet</h3>

<p>Схема модуля позаимствована из схемы платы LPC1830-Xplorer (OM13028).</p>

<p>Модуль построен на PHY <strong>LAN8720</strong> (U11). PHY тактируется от кварцевого генератора KXO-V97 частотой 50 МГц (самый крайний по приемлемости вариант, лучше использовать более точный генератор).</p>

<p>Особое внимание необходимо уделить питанию PHY. В цепи питания установлен LC-фильтр на базе L4 и C26-C28 (аналогично схеме-донору).</p>

<p>Сигнальный трансформатор встроен в разъём RJ-45 (XS1). В нём же установлены светодиоды, информирующие о скорости работы интерфейса и активности на линии.</p>

<h3>Часы реального времени</h3>

<p>Используется микросхема <strong>DS3231M</strong> (U13). Очень хороший вариант, рекомендую.</p>

<p>Часы могут работать как от основного питания, так от батарейки (в случае отсутствия основного питания). Взаимодействие микроконтроллера с часами происходит по интерфейсу I<sup>2</sup>C. Номиналы резисторов R87, R88 на линиях SDA и SCL определяют максимальную скорость информационного обмена. Установлены резисторы номиналом 10 кОм (при том, что имелся опыт работы на частоте 400 кГц с резисторами номиналом 22 кОм).</p>

<h3>Энергонезависимая память</h3>

<p>В качестве микросхемы энергонезависимой памяти используется <strong>AT45DB321D</strong> (U12) объёмом 4 Мбайт. Это довольно продвинутая память, которая берёт часть работы программиста на себя. Так, при записи новых данных, она копирует страницу во внутреннее ОЗУ, стирает страницу, а затем пишет в стёртую страницу результат слияния прошлых данных с теми, которые были переданы пользователем.</p>

<h3>Драйвер RS-485</h3>

<p>Для связи с периферийными устройствами по асинхронному последовательному каналу в контроллере находится драйвер шины RS-485 <strong>MAX-487</strong> (U9) с управлением потоком (чтение/запись).</p>

<h3>Схема токового управления нагрузкой</h3>

<p>Схема управления питанием основана на pnp-транзисторе (Q4-Q7), с помощью которого выдаётся сигнал на оптопару. Расчёт схемы проведён исходя из того, что на другой стороне установлены оптопары типа <strong>HCPL0530/&frac14;</strong>.</p>

<p>1) Прямой ток через диод оптопары составляет IF = (3,3 – VF) / R55 = (3,3 – 1,45) / 100 = 18,5 мА (VF - падение напряжения на диоде).</p>

<p>2) Максимальный выходной ток оптопары при IF = 18,5 мА составляет примерно IO = 6 мА.</p>

<p>3) Для управления оптопарой выбран транзистор <strong>BC807</strong> (коэффициент усиления по току – 100, не менее; в базе резистор 4,7 кОм, то есть базовый ток составляет (3,3 – 0,7) / 4,7 = 0,55 мА, что позволяет получить ток коллектора от 50 мА и выше).</p>

<p><strong>Измерения тока в цепи нагрузки</strong></p>

<p>Из схемы питания нагрузки в основной микроконтроллер через оптопару поступают импульсы (разъёмы XT17, XT18). Коллектор оптопары подтянут к питанию +3,3V через резистор номиналом 4,7 кОм (R60-R63).</p>

<h3>Подключение радиомодуля</h3>

<p>Предполагается, что в устройстве будет использован радиомодуль <strong>RF-2423P</strong>, работающий в области частоты 2,4 ГГц. Подключение радиомодуля осуществляется через разъём XP2 (PBD-8). Линия питания поддержана дополнительным танталовым конденсатором C11 ёмкостью 10 мкФ.</p>
]]></content>
  </entry>
  
</feed>